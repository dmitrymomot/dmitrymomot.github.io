---
import Layout from '../../layouts/Layout.astro';
import Footer from '../../components/Footer.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  // Sort by date for prev/next navigation
  posts.sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf());

  return posts.map((post, index) => ({
    params: { id: post.id },
    props: {
      post,
      prevPost: index < posts.length - 1 ? posts[index + 1] : null,
      nextPost: index > 0 ? posts[index - 1] : null,
    },
  }));
}

const { post, prevPost, nextPost } = Astro.props;
const { Content } = await render(post);

const firstTag = post.data.tags[0] || 'blog';

const articleLD = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": post.data.title,
  "description": post.data.description,
  "author": {
    "@type": "Person",
    "name": "Dmytro Momot",
    "url": "https://dmomot.com"
  },
  "datePublished": post.data.publishDate.toISOString(),
  "dateModified": post.data.publishDate.toISOString(),
  "publisher": {
    "@type": "Person",
    "name": "Dmytro Momot"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": `https://dmomot.com/blog/${post.id}`
  },
  "keywords": post.data.tags.join(", ")
};
---

<Layout
  title={`${post.data.title} - Dmytro Momot`}
  description={post.data.description}
  type="article"
  image="/og-blog-image.jpg"
>
  <script slot="head" type="application/ld+json" set:html={JSON.stringify(articleLD)} />

  <div class="h-px bg-[#2A2B30]"></div>

  <!-- Article Header -->
  <section class="bg-[#16171B]">
    <div class="max-w-[1280px] mx-auto flex flex-col gap-5 pt-[60px] pb-10 px-6 lg:px-[320px]">
      <!-- Breadcrumb -->
      <nav class="flex items-center gap-2">
        <a href="/blog" class="font-mono text-[11px] font-medium text-[#52525B] hover:text-[#71717A] transition-colors">Blog</a>
        <span class="font-mono text-[11px] text-[#3F3F46]">/</span>
        <a href={`/blog/tag/${firstTag}`} class="font-mono text-[11px] font-medium text-[#22C55E]">{firstTag}</a>
      </nav>

      <h1 class="text-3xl md:text-[42px] font-bold text-[#F4F4F5]" style="font-family: 'Space Grotesk', sans-serif; letter-spacing: -1.5px; line-height: 1.15;">
        {post.data.title}
      </h1>

      <!-- Meta -->
      <div class="flex items-center gap-4">
        <span class="font-mono text-xs font-medium text-[#52525B]">
          {post.data.publishDate.toLocaleDateString('en-US', {
            month: 'long',
            day: 'numeric',
            year: 'numeric'
          })}
        </span>
        <span class="font-mono text-xs text-[#3F3F46]">&middot;</span>
        <span class="font-mono text-xs font-medium text-[#52525B]">Dmytro Momot</span>
      </div>
    </div>
  </section>

  <!-- Article Body -->
  <main class="bg-[#16171B]">
    <div class="max-w-[1280px] mx-auto px-6 lg:px-[320px] pb-[60px]">
      <!-- Lead paragraph (description) -->
      <p class="text-lg italic font-medium text-[#A1A1AA] mb-8" style="line-height: 1.7;">
        {post.data.description}
      </p>

      <!-- Green divider -->
      <div class="w-[60px] h-0.5 bg-[#22C55E] mb-8"></div>

      <article class="prose-custom">
        <Content />
      </article>

      <!-- Tags -->
      <div class="border-t border-[#2A2B30] pt-5 flex gap-2 flex-wrap">
        {post.data.tags.map((tag) => (
          <a
            href={`/blog/tag/${tag}`}
            class="border border-[#3F3F46] rounded-sm px-3 py-1 font-mono text-[10px] font-medium text-[#52525B] hover:text-[#71717A] hover:border-[#52525B] transition-colors"
          >
            {tag}
          </a>
        ))}
      </div>
    </div>
  </main>

  <!-- Prev/Next Navigation -->
  {(prevPost || nextPost) && (
    <section class="bg-[#16171B]">
      <div class="max-w-[1280px] mx-auto flex justify-between gap-8 px-6 lg:px-[320px] py-10 border-t border-[#2A2B30]">
        {prevPost ? (
          <a href={`/blog/${prevPost.id}`} class="flex flex-col gap-1.5 group">
            <span class="font-mono text-[10px] font-medium text-[#52525B]">&larr; PREVIOUS</span>
            <span class="text-base font-semibold text-[#F4F4F5] group-hover:text-[#22C55E] transition-colors" style="font-family: 'Space Grotesk', sans-serif;">
              {prevPost.data.title}
            </span>
          </a>
        ) : <div />}
        {nextPost ? (
          <a href={`/blog/${nextPost.id}`} class="flex flex-col gap-1.5 items-end group">
            <span class="font-mono text-[10px] font-medium text-[#52525B]">NEXT &rarr;</span>
            <span class="text-base font-semibold text-[#F4F4F5] group-hover:text-[#22C55E] transition-colors" style="font-family: 'Space Grotesk', sans-serif;">
              {nextPost.data.title}
            </span>
          </a>
        ) : <div />}
      </div>
    </section>
  )}

  <div class="h-px bg-[#2A2B30]"></div>
  <Footer />
</Layout>
