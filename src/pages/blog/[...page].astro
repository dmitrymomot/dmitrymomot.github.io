---
import Layout from '../../layouts/Layout.astro';
import Footer from '../../components/Footer.astro';
import { getCollection } from 'astro:content';
import type { GetStaticPaths } from 'astro';

export const getStaticPaths: GetStaticPaths = async ({ paginate }) => {
  const posts = await getCollection('blog', ({ data }) => {
    return !data.draft;
  });

  posts.sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf());

  return paginate(posts, { pageSize: 5 });
};

const { page } = Astro.props;
---

<Layout title="Blog - Dmytro Momot" description="Articles about software development, architecture, and technology">
  <div class="h-px bg-[#2A2B30]"></div>

  <!-- Blog Hero -->
  <section class="bg-[#16171B]">
    <div class="max-w-[1280px] mx-auto flex flex-col gap-4 pt-[60px] pb-10 px-6 lg:px-[120px]">
      <p class="font-mono text-[11px] font-semibold text-[#71717A]">// BLOG</p>
      <h1 class="text-3xl md:text-[40px] font-bold text-[#F4F4F5] max-w-[700px]" style="font-family: 'Space Grotesk', sans-serif; letter-spacing: -1px; line-height: 1.2;">
        Writing about engineering, leadership & building things
      </h1>
      <div class="flex items-center gap-4">
        <span class="font-mono text-xs font-medium text-[#52525B]">{page.total} posts</span>
        <span class="font-mono text-xs text-[#3F3F46]">&middot;</span>
        <a href="/blog/tags" class="font-mono text-xs font-medium text-[#22C55E] hover:text-[#16A34A] transition-colors">
          Browse by Topics &rarr;
        </a>
      </div>
    </div>
  </section>

  <!-- Posts List -->
  <section class="bg-[#16171B]">
    <div class="max-w-[1280px] mx-auto px-6 lg:px-[120px]">
      {page.data.map((post) => (
        <article class="flex flex-col md:flex-row gap-4 md:gap-10 py-7 border-t border-[#2A2B30]">
          <div class="flex-shrink-0">
            <time class="font-mono text-xs font-medium text-[#52525B] whitespace-nowrap">
              {post.data.publishDate.toLocaleDateString('en-US', {
                month: 'short',
                day: '2-digit',
                year: 'numeric'
              })}
            </time>
          </div>
          <div class="flex flex-col gap-3">
            <h2 style="font-family: 'Space Grotesk', sans-serif; letter-spacing: -0.3px;">
              <a href={`/blog/${post.id}`} class="text-[22px] font-bold text-[#F4F4F5] hover:text-[#22C55E] transition-colors">
                {post.data.title}
              </a>
            </h2>
            <p class="text-sm text-[#71717A] leading-relaxed">
              {post.data.description}
            </p>
            <div class="flex gap-2 flex-wrap">
              {post.data.tags.map((tag) => (
                <a
                  href={`/blog/tag/${tag}`}
                  class="border border-[#3F3F46] rounded-sm px-2 py-0.5 font-mono text-[10px] font-medium text-[#52525B] hover:text-[#71717A] hover:border-[#52525B] transition-colors"
                >
                  {tag}
                </a>
              ))}
            </div>
          </div>
        </article>
      ))}
    </div>
  </section>

  <!-- Pagination -->
  {page.lastPage > 1 && (
    <section class="bg-[#16171B]">
      <div class="max-w-[1280px] mx-auto flex justify-center items-center gap-2 py-10 px-6 lg:px-[120px]">
        {Array.from({ length: page.lastPage }, (_, i) => i + 1).map((num) => (
          <a
            href={num === 1 ? '/blog' : `/blog/${num}`}
            class:list={[
              "font-mono text-[13px] font-medium rounded-sm px-3.5 py-2 transition-colors",
              num === page.currentPage
                ? "bg-[#22C55E] text-[#16171B] font-bold"
                : "border border-[#2A2B30] text-[#71717A] hover:text-[#F4F4F5] hover:border-[#3F3F46]"
            ]}
          >
            {num}
          </a>
        ))}
        {page.url.next && (
          <a
            href={page.url.next}
            class="font-mono text-[13px] font-medium rounded-sm px-3.5 py-2 border border-[#2A2B30] text-[#71717A] hover:text-[#F4F4F5] hover:border-[#3F3F46] transition-colors"
          >
            &rarr;
          </a>
        )}
      </div>
    </section>
  )}

  <div class="h-px bg-[#2A2B30]"></div>
  <Footer />
</Layout>
